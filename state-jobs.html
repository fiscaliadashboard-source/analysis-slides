<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>An치lisis de Planta - DECDI</title>
    <style>
        /* Todos los estilos CSS anteriores se mantienen igual */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a3a8f 0%, #2c5aa0 100%);
            color: #333;
            line-height: 1.6;
            overflow: hidden;
        }
        
        .slides-container {
            width: 100vw;
            height: 100vh;
            display: flex;
            transition: transform 0.5s ease-in-out;
        }
        
        .slide {
            min-width: 100vw;
            height: 100vh;
            padding: 40px;
            display: flex;
            flex-direction: column;
            background: white;
            overflow-y: auto;
        }
        
        .slide-header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .slide-title {
            color: #1a3a8f;
            font-size: 2.8rem;
            margin-bottom: 15px;
        }
        
        .slide-subtitle {
            color: #2c5aa0;
            font-size: 1.4rem;
            font-weight: normal;
        }
        
        .content {
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
            flex: 1;
        }
        
        .stats-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin: 30px 0;
            justify-content: center;
        }
        
        .stat-card {
            flex: 1;
            min-width: 200px;
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            border-left: 6px solid #1a3a8f;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #1a3a8f;
            margin-bottom: 8px;
        }
        
        .stat-label {
            font-size: 1rem;
            color: #666;
        }
        
        .chart-container {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            margin: 30px 0;
        }
        
        .chart {
            flex: 1;
            min-width: 400px;
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .bar {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            width: 100%;
        }
        
        .bar-label {
            width: 200px;
            font-size: 1rem;
            font-weight: 500;
        }
        
        .bar-value {
            flex-grow: 1;
            height: 30px;
            background: linear-gradient(90deg, #1a3a8f, #2c5aa0);
            border-radius: 6px;
            display: flex;
            align-items: center;
            padding-left: 15px;
            color: white;
            font-weight: bold;
            min-width: 120px;
        }
        
        .insight {
            background: #e8f4fd;
            border-left: 6px solid #2c5aa0;
            padding: 25px;
            margin: 25px 0;
            border-radius: 0 12px 12px 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .recommendation {
            background: #f0f8f0;
            border-left: 6px solid #28a745;
            padding: 25px;
            margin: 25px 0;
            border-radius: 0 12px 12px 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .cargo-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 5px solid #1a3a8f;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .cargo-nombre {
            font-weight: bold;
            color: #1a3a8f;
            font-size: 1.1rem;
        }
        
        .tipo-nombramiento {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.9rem;
            margin-top: 8px;
            font-weight: bold;
        }
        
        .provisionalidad {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .propiedad {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .encargo {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .fechas {
            font-size: 0.9rem;
            color: #666;
            margin-top: 8px;
        }
        
        .navegacion {
            position: fixed;
            bottom: 30px;
            right: 30px;
            display: flex;
            gap: 15px;
            z-index: 1000;
        }
        
        .btn-nav {
            background: #1a3a8f;
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }
        
        .btn-nav:hover {
            background: #2c5aa0;
            transform: translateY(-2px);
        }
        
        .btn-nav:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }
        
        .indicadores {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 1000;
        }
        
        .indicador {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255,255,255,0.5);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .indicador.activo {
            background: white;
            transform: scale(1.2);
        }
        
        h2 {
            color: #1a3a8f;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid #eaeaea;
            font-size: 2.2rem;
        }
        
        h3 {
            color: #2c5aa0;
            margin: 20px 0 15px;
            font-size: 1.5rem;
        }
        
        ul, ol {
            margin: 15px 0;
            padding-left: 25px;
        }
        
        li {
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .critical {
            color: #dc3545;
            font-weight: bold;
        }
        
        .highlight {
            background: linear-gradient(120deg, #ffd700 0%, #ffd700 100%);
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
        }
        
        .encargo-item {
            background: #fff3cd;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 5px solid #ffc107;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .encargo-nombre {
            font-weight: bold;
            color: #856404;
            font-size: 1.1rem;
        }
        
        .filtros-container {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .filtro-group {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .filtro-label {
            font-weight: bold;
            color: #1a3a8f;
            min-width: 120px;
        }
        
        select {
            padding: 10px 15px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            background: white;
            font-size: 1rem;
            min-width: 300px;
        }
        
        .resultados-filtro {
            max-height: 500px;
            overflow-y: auto;
            margin-top: 20px;
        }
        
        .persona-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #1a3a8f;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        
        .persona-nombre {
            font-weight: bold;
            color: #1a3a8f;
            font-size: 1.1rem;
        }
        
        .persona-cargo {
            color: #666;
            margin-top: 5px;
        }
        
        .persona-detalle {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 0.9rem;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .grafica-cargos {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .cargo-grafica-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            border-left: 4px solid #1a3a8f;
        }
        
        .cargo-grafica-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .cargo-grafica-nombre {
            font-weight: bold;
            color: #1a3a8f;
            font-size: 1rem;
        }
        
        .cargo-grafica-total {
            background: #1a3a8f;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: bold;
        }
        
        .cargo-grafica-detalle {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .cargo-grafica-linea {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .cargo-grafica-tipo {
            font-size: 0.9rem;
        }
        
        .cargo-grafica-cantidad {
            font-weight: bold;
            color: #1a3a8f;
        }
        
        .restart-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #dc3545;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        
        .todos-cargos-container {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .cargos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 15px;
            margin-top: 20px;
            max-height: 600px;
            overflow-y: auto;
        }
        
        .cargo-completo-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            border-left: 4px solid #1a3a8f;
        }
        
        .cargo-completo-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eaeaea;
        }
        
        .cargo-completo-nombre {
            font-weight: bold;
            color: #1a3a8f;
            font-size: 1.1rem;
            flex: 1;
        }
        
        .cargo-completo-total {
            background: #1a3a8f;
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .cargo-completo-personas {
            margin-top: 10px;
        }
        
        .persona-cargo-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .persona-cargo-nombre {
            font-size: 0.9rem;
            flex: 1;
        }
        
        .persona-cargo-estado {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }
        
        .search-section {
            background: #e8f4fd;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .search-input {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #1a3a8f;
            border-radius: 6px;
            font-size: 1rem;
            margin-bottom: 10px;
        }

        /* Nuevos estilos para el an치lisis de carga */
        .carga-bar-container {
            background: #e9ecef;
            border-radius: 4px;
            height: 20px;
            width: 100%;
            overflow: hidden;
            margin-top: 8px;
        }
        
        .carga-bar {
            background: linear-gradient(90deg, #1a3a8f, #2c5aa0);
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8rem;
            font-weight: bold;
            transition: width 0.3s ease;
        }
        
        .carga-stats {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-bottom: 8px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .carga-stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 80px;
        }
        
        .carga-stat-value {
            font-weight: bold;
            color: #1a3a8f;
            font-size: 1.1rem;
        }
        
        .carga-stat-label {
            font-size: 0.8rem;
            color: #666;
        }

        /* Estilos para el sem치foro de carga */
        .semaforo-container {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin: 25px 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .semaforo-title {
            color: #1a3a8f;
            font-size: 1.5rem;
            margin-bottom: 20px;
            text-align: center;
        }

        .semaforo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .semaforo-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            border-left: 4px solid #6c757d;
        }

        .semaforo-item.alta {
            border-left-color: #dc3545;
        }

        .semaforo-item.media {
            border-left-color: #ffc107;
        }

        .semaforo-item.baja {
            border-left-color: #28a745;
        }

        .semaforo-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .semaforo-nivel {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .semaforo-indicador {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .semaforo-indicador.alta {
            background: #dc3545;
        }

        .semaforo-indicador.media {
            background: #ffc107;
        }

        .semaforo-indicador.baja {
            background: #28a745;
        }

        .semaforo-lista {
            margin-top: 10px;
            max-height: 200px;
            overflow-y: auto;
        }

        .semaforo-persona {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .semaforo-persona:last-child {
            border-bottom: none;
        }

        .semaforo-persona-nombre {
            font-size: 0.9rem;
            flex: 1;
        }

        .semaforo-persona-carga {
            font-weight: bold;
            font-size: 0.9rem;
            min-width: 60px;
            text-align: right;
        }

        .semaforo-leyenda {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .leyenda-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .leyenda-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 2px solid #fff;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }

        .leyenda-alta { background: #dc3545; }
        .leyenda-media { background: #ffc107; }
        .leyenda-baja { background: #28a745; }

        /* Estilos para la carga de CSV */
        .csv-upload-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background: white;
            padding: 40px;
        }

        .upload-box {
            background: #f8f9fa;
            border: 3px dashed #1a3a8f;
            border-radius: 12px;
            padding: 60px 40px;
            text-align: center;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .upload-icon {
            font-size: 4rem;
            color: #1a3a8f;
            margin-bottom: 20px;
        }

        .upload-title {
            color: #1a3a8f;
            font-size: 2rem;
            margin-bottom: 15px;
        }

        .upload-subtitle {
            color: #666;
            font-size: 1.1rem;
            margin-bottom: 30px;
        }

        .file-input {
            display: none;
        }

        .file-label {
            background: #1a3a8f;
            color: white;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
            transition: all 0.3s ease;
            display: inline-block;
        }

        .file-label:hover {
            background: #2c5aa0;
            transform: translateY(-2px);
        }

        .file-name {
            margin-top: 15px;
            color: #666;
            font-size: 0.9rem;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 6px;
            margin-top: 20px;
            border-left: 4px solid #dc3545;
            display: none;
        }

        .success-message {
            background: #d1edff;
            color: #0c5460;
            padding: 15px;
            border-radius: 6px;
            margin-top: 20px;
            border-left: 4px solid #1a3a8f;
            display: none;
        }

        .requirements {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 20px;
            margin-top: 30px;
            text-align: left;
        }

        .requirements h4 {
            color: #856404;
            margin-bottom: 10px;
        }

        .requirements ul {
            margin: 0;
            padding-left: 20px;
        }

        .requirements li {
            font-size: 0.9rem;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div id="csvUploadContainer" class="csv-upload-container">
        <div class="upload-box">
            <div class="upload-icon">游늵</div>
            <h2 class="upload-title">Cargar Datos de Personal</h2>
            <p class="upload-subtitle">Selecciona un archivo CSV con los datos de personal para generar el an치lisis</p>
            
            <input type="file" id="csvFile" class="file-input" accept=".csv">
            <label for="csvFile" class="file-label">Seleccionar Archivo CSV</label>
            <div id="fileName" class="file-name"></div>
            
            <div id="errorMessage" class="error-message">
                Error al cargar el archivo. Por favor verifica el formato.
            </div>
            
            <div id="successMessage" class="success-message">
                Archivo cargado correctamente. Generando presentaci칩n...
            </div>

            <div class="requirements">
                <h4>Requisitos del archivo CSV:</h4>
                <ul>
                    <li><strong>Columnas requeridas:</strong> NUM_DOCUMENTO, NOM_APELLIDOS, NOM_TIP_NOMBRAMIENTO, NOM_CARGO, NOM_CAR_ENCARGO</li>
                    <li><strong>Columnas recomendadas para an치lisis de carga:</strong> DESPACHO_FISCAL, SPOA, APOYOS, DECDI</li>
                    <li>Formato UTF-8</li>
                    <li>Separado por comas</li>
                    <li>Primera fila debe ser el encabezado</li>
                    <li>El an치lisis de carga laboral se enfoca en personal fiscal (excluye "NO ES FISCAL")</li>
                </ul>
            </div>
        </div>
    </div>

    <div id="presentationContainer" style="display: none;">
        <button class="restart-btn" onclick="irASlide(0)">Reiniciar Presentaci칩n</button>

        <div class="slides-container" id="slidesContainer">
            <!-- Los slides se generan din치micamente despu칠s de cargar el CSV -->
        </div>

        <div class="navegacion">
            <button class="btn-nav" id="btnAnterior" onclick="cambiarSlide(-1)">Anterior</button>
            <button class="btn-nav" id="btnSiguiente" onclick="cambiarSlide(1)">Siguiente</button>
        </div>

        <div class="indicadores" id="indicadores">
            <!-- Los indicadores se generan autom치ticamente -->
        </div>
    </div>

    <script>
        // Variables globales para los datos
        let datosPersonas = [];
        let datosCargaFiscal = [];
        let slideActual = 0;
        let totalSlides = 0;

        // Elementos del DOM
        const csvUploadContainer = document.getElementById('csvUploadContainer');
        const presentationContainer = document.getElementById('presentationContainer');
        const csvFileInput = document.getElementById('csvFile');
        const fileNameDisplay = document.getElementById('fileName');
        const errorMessage = document.getElementById('errorMessage');
        const successMessage = document.getElementById('successMessage');

        // Event listener para la carga del archivo
        csvFileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                fileNameDisplay.textContent = `Archivo seleccionado: ${file.name}`;
                errorMessage.style.display = 'none';
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const csvData = e.target.result;
                        procesarCSV(csvData);
                    } catch (error) {
                        mostrarError('Error al procesar el archivo: ' + error.message);
                    }
                };
                reader.onerror = function() {
                    mostrarError('Error al leer el archivo');
                };
                reader.readAsText(file, 'UTF-8');
            }
        });

        function mostrarError(mensaje) {
            errorMessage.textContent = mensaje;
            errorMessage.style.display = 'block';
            successMessage.style.display = 'none';
        }

        function mostrarExito() {
            errorMessage.style.display = 'none';
            successMessage.style.display = 'block';
        }

        function procesarCSV(csvData) {
            try {
                const lineas = csvData.split('\n');
                if (lineas.length < 2) {
                    mostrarError('El archivo CSV est치 vac칤o o no tiene datos');
                    return;
                }

                // Obtener encabezados
                const encabezados = lineas[0].split(',').map(h => h.trim().replace(/"/g, ''));
                
                // Verificar encabezados requeridos
                const encabezadosRequeridos = ['NUM_DOCUMENTO', 'NOM_APELLIDOS', 'NOM_TIP_NOMBRAMIENTO', 'NOM_CARGO', 'NOM_CAR_ENCARGO'];
                const encabezadosFaltantes = encabezadosRequeridos.filter(h => !encabezados.includes(h));
                
                if (encabezadosFaltantes.length > 0) {
                    mostrarError(`Faltan columnas requeridas: ${encabezadosFaltantes.join(', ')}`);
                    return;
                }

                // Verificar columnas de carga (opcionales pero recomendadas)
                const tieneDespachoFiscal = encabezados.includes('DESPACHO_FISCAL');
                const tieneDatosCarga = encabezados.includes('SPOA') && encabezados.includes('APOYOS') && encabezados.includes('DECDI');
                
                if (!tieneDespachoFiscal) {
                    console.warn('Advertencia: No se encontr칩 la columna DESPACHO_FISCAL. El an치lisis de carga laboral no se generar치.');
                }
                
                if (!tieneDatosCarga) {
                    console.warn('Advertencia: No se encontraron las columnas SPOA, APOYOS, DECDI. El an치lisis de carga laboral no se generar치.');
                }

                // Procesar datos
                datosPersonas = [];
                for (let i = 1; i < lineas.length; i++) {
                    if (lineas[i].trim() === '') continue;
                    
                    const valores = parseCSVLine(lineas[i]);
                    if (valores.length === encabezados.length) {
                        const persona = {};
                        encabezados.forEach((encabezado, index) => {
                            persona[encabezado] = valores[index] || '';
                        });
                        
                        // Mapear a la estructura esperada
                        const datosPersona = {
                            nombre: persona.NOM_APELLIDOS,
                            cargo: persona.NOM_CARGO,
                            encargo: persona.NOM_CAR_ENCARGO,
                            nombramiento: persona.NOM_TIP_NOMBRAMIENTO
                        };
                        
                        // Agregar campos opcionales si existen
                        if (tieneDespachoFiscal) {
                            datosPersona.despachoFiscal = persona.DESPACHO_FISCAL;
                        }
                        if (tieneDatosCarga) {
                            datosPersona.spoa = persona.SPOA;
                            datosPersona.apoyos = persona.APOYOS;
                            datosPersona.decdi = persona.DECDI;
                        }
                        
                        datosPersonas.push(datosPersona);
                    }
                }

                if (datosPersonas.length === 0) {
                    mostrarError('No se pudieron procesar datos del archivo CSV');
                    return;
                }

                // Generar datos de carga fiscal solo si tenemos las columnas necesarias
                if (tieneDespachoFiscal && tieneDatosCarga) {
                    generarDatosCargaFiscalDesdeCSV();
                } else {
                    datosCargaFiscal = [];
                }
                
                mostrarExito();
                
                // Esperar un momento y luego generar la presentaci칩n
                setTimeout(() => {
                    csvUploadContainer.style.display = 'none';
                    presentationContainer.style.display = 'block';
                    generarPresentacionCompleta();
                }, 1000);

            } catch (error) {
                mostrarError('Error al procesar el CSV: ' + error.message);
            }
        }

        function parseCSVLine(line) {
            const resultado = [];
            let campoActual = '';
            let entreComillas = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    entreComillas = !entreComillas;
                } else if (char === ',' && !entreComillas) {
                    resultado.push(campoActual.trim());
                    campoActual = '';
                } else {
                    campoActual += char;
                }
            }
            
            resultado.push(campoActual.trim());
            return resultado.map(campo => campo.replace(/^"|"$/g, ''));
        }

        function generarDatosCargaFiscalDesdeCSV() {
            // Filtrar solo fiscales (excluyendo "NO ES FISCAL")
            const fiscales = datosPersonas.filter(persona => {
                const esFiscal = persona.despachoFiscal && 
                                persona.despachoFiscal !== "NO ES FISCAL" &&
                                persona.despachoFiscal !== "" &&
                                persona.despachoFiscal !== null &&
                                persona.despachoFiscal !== undefined;
                return esFiscal;
            });

            console.log(`Fiscales identificados: ${fiscales.length} de ${datosPersonas.length} registros totales`);

            // Procesar TODOS los fiscales, no filtrar por "tieneDatosReales"
            datosCargaFiscal = fiscales.map((fiscal, index) => {
                // Convertir los datos de carga a n칰meros (manejar valores vac칤os, nulos o no num칠ricos)
                const spoa = fiscal.spoa !== undefined && fiscal.spoa !== null && fiscal.spoa !== '' && !isNaN(parseInt(fiscal.spoa)) ? parseInt(fiscal.spoa) : 0;
                const apoyos = fiscal.apoyos !== undefined && fiscal.apoyos !== null && fiscal.apoyos !== '' && !isNaN(parseInt(fiscal.apoyos)) ? parseInt(fiscal.apoyos) : 0;
                const decdi = fiscal.decdi !== undefined && fiscal.decdi !== null && fiscal.decdi !== '' && !isNaN(parseInt(fiscal.decdi)) ? parseInt(fiscal.decdi) : 0;
                const total = spoa + apoyos + decdi;
                
                return {
                    nombre: fiscal.nombre.toUpperCase(),
                    spoa: spoa,
                    apoyos: apoyos,
                    decdi: decdi,
                    total: total,
                    despachoFiscal: fiscal.despachoFiscal,
                    cargo: fiscal.cargo,
                    nombramiento: fiscal.nombramiento
                };
            });

            console.log(`Fiscales procesados: ${datosCargaFiscal.length}`);
            
            // Debug: mostrar todos los fiscales para verificar
            console.log('Todos los fiscales procesados:', datosCargaFiscal);
        }

        function generarSlideCargaLaboral() {
            // Filtrar solo fiscales para las estad칤sticas
            const totalFiscales = datosCargaFiscal.length;
            
            if (totalFiscales === 0) {
                return `
                    <div class="slide">
                        <div class="content">
                            <h2>An치lisis de Carga Laboral por Fiscal</h2>
                            <div class="insight">
                                <h3>No hay datos de carga laboral disponibles</h3>
                                <p>No se encontraron registros de fiscales con carga laboral en los datos cargados.</p>
                                <p>Para generar este an치lisis, el archivo CSV debe incluir:</p>
                                <ul>
                                    <li>Columna "DESPACHO_FISCAL" con valores diferentes a "NO ES FISCAL"</li>
                                    <li>Columnas "SPOA", "APOYOS", "DECDI" con datos num칠ricos de carga laboral</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                `;
            }

            const totalCargaSPOA = datosCargaFiscal.reduce((sum, fiscal) => sum + fiscal.spoa, 0);
            const totalCargaApoyos = datosCargaFiscal.reduce((sum, fiscal) => sum + fiscal.apoyos, 0);
            const totalCargaDECDI = datosCargaFiscal.reduce((sum, fiscal) => sum + fiscal.decdi, 0);
            const totalCargaGeneral = totalCargaSPOA + totalCargaApoyos + totalCargaDECDI;

            const cargaOrdenada = [...datosCargaFiscal].sort((a, b) => b.total - a.total);
            const fiscalMayorCarga = cargaOrdenada[0];
            const promedioCarga = totalFiscales > 0 ? cargaOrdenada.reduce((sum, fiscal) => sum + fiscal.total, 0) / totalFiscales : 0;
            const fiscalesSobrePromedio = cargaOrdenada.filter(f => f.total > promedioCarga).length;
            
            // Calcular porcentajes de distribuci칩n
            const porcentajeSPOA = totalCargaGeneral > 0 ? (totalCargaSPOA / totalCargaGeneral * 100) : 0;
            const porcentajeApoyos = totalCargaGeneral > 0 ? (totalCargaApoyos / totalCargaGeneral * 100) : 0;
            const porcentajeDECDI = totalCargaGeneral > 0 ? (totalCargaDECDI / totalCargaGeneral * 100) : 0;

            // Identificar fiscales por tipo de carga
            const fiscalesAltaSPOA = datosCargaFiscal.filter(f => f.spoa >= 15).length;
            const fiscalesAltaApoyos = datosCargaFiscal.filter(f => f.apoyos >= 8).length;
            const fiscalesAltaDECDI = datosCargaFiscal.filter(f => f.decdi >= 5).length;

            // Generar HTML para los resultados
            const resultadosCargaHTML = cargaOrdenada.map(fiscal => {
                // Calcular el m치ximo de carga, asegurando que sea al menos 1 para evitar divisi칩n por cero
                const maxCarga = Math.max(1, ...cargaOrdenada.map(f => f.total));
                const porcentajeTotal = (fiscal.total / maxCarga) * 100;
                
                // Asegurar que la barra tenga un ancho m칤nimo para mostrar el texto
                const anchoBarra = Math.max(porcentajeTotal, 15); // M칤nimo 15% para que se vea el texto
                
                return `
                    <div class="persona-item">
                        <div class="persona-nombre">${fiscal.nombre}</div>
                        <div class="persona-cargo">${fiscal.cargo || 'Fiscal'} - ${fiscal.despachoFiscal}</div>
                        <div class="persona-detalle">
                            <div class="carga-stats">
                                <div class="carga-stat-item">
                                    <div class="carga-stat-value">${fiscal.spoa}</div>
                                    <div class="carga-stat-label">SPOA/DECDI</div>
                                </div>
                                <div class="carga-stat-item">
                                    <div class="carga-stat-value">${fiscal.apoyos}</div>
                                    <div class="carga-stat-label">Apoyos Sec.</div>
                                </div>
                                <div class="carga-stat-item">
                                    <div class="carga-stat-value">${fiscal.decdi}</div>
                                    <div class="carga-stat-label">Apoyo-DECDI</div>
                                </div>
                                <div class="carga-stat-item">
                                    <div class="carga-stat-value">${fiscal.total}</div>
                                    <div class="carga-stat-label">Total</div>
                                </div>
                            </div>
                            <div class="carga-bar-container">
                                <div class="carga-bar" style="width: ${anchoBarra}%">
                                    ${fiscal.total} casos
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            // Generar sem치foro con criterios realistas ORDENADO DE MAYOR A MENOR
            const cargaAlta = datosCargaFiscal.filter(f => f.total >= 25).sort((a, b) => b.total - a.total);
            const cargaMedia = datosCargaFiscal.filter(f => f.total >= 15 && f.total < 25).sort((a, b) => b.total - a.total);
            const cargaBaja = datosCargaFiscal.filter(f => f.total < 15).sort((a, b) => b.total - a.total);

            const semaforoHTML = `
                ${cargaAlta.length > 0 ? `
                    <div class="semaforo-item alta">
                        <div class="semaforo-header">
                            <div class="semaforo-nivel">Alta Carga (25+ casos) - ${cargaAlta.length} fiscales</div>
                            <div class="semaforo-indicador alta"></div>
                        </div>
                        <div class="semaforo-lista">
                            ${cargaAlta.map(fiscal => `
                                <div class="semaforo-persona">
                                    <div class="semaforo-persona-nombre">${fiscal.nombre}</div>
                                    <div class="semaforo-persona-carga">${fiscal.total} casos</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}
                ${cargaMedia.length > 0 ? `
                    <div class="semaforo-item media">
                        <div class="semaforo-header">
                            <div class="semaforo-nivel">Media Carga (15-24 casos) - ${cargaMedia.length} fiscales</div>
                            <div class="semaforo-indicador media"></div>
                        </div>
                        <div class="semaforo-lista">
                            ${cargaMedia.map(fiscal => `
                                <div class="semaforo-persona">
                                    <div class="semaforo-persona-nombre">${fiscal.nombre}</div>
                                    <div class="semaforo-persona-carga">${fiscal.total} casos</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}
                ${cargaBaja.length > 0 ? `
                    <div class="semaforo-item baja">
                        <div class="semaforo-header">
                            <div class="semaforo-nivel">Baja Carga (0-14 casos) - ${cargaBaja.length} fiscales</div>
                            <div class="semaforo-indicador baja"></div>
                        </div>
                        <div class="semaforo-lista">
                            ${cargaBaja.map(fiscal => `
                                <div class="semaforo-persona">
                                    <div class="semaforo-persona-nombre">${fiscal.nombre}</div>
                                    <div class="semaforo-persona-carga">${fiscal.total} casos</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}
            `;

            return `
                <div class="slide">
                    <div class="content">
                        <h2>An치lisis de Carga Laboral por Fiscal</h2>
                        <p>Distribuci칩n de trabajo en SPOA/DECDI, Apoyos Seccionales y Apoyo-DECDI</p>
                        <p><strong>Base de an치lisis:</strong> ${totalFiscales} fiscales con carga laboral activa</p>
                        
                        <div class="stats-container">
                            <div class="stat-card">
                                <div class="stat-value">${totalFiscales}</div>
                                <div class="stat-label">Fiscales con Carga</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${totalCargaSPOA}</div>
                                <div class="stat-label">Total SPOA/DECDI</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${totalCargaApoyos}</div>
                                <div class="stat-label">Total Apoyos Sec.</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${totalCargaDECDI}</div>
                                <div class="stat-label">Total Apoyo-DECDI</div>
                            </div>
                        </div>

                        <div class="chart-container">
                            <div class="chart">
                                <h3>Distribuci칩n de Carga por Tipo</h3>
                                <div class="bar">
                                    <div class="bar-label">SPOA/DECDI</div>
                                    <div class="bar-value" style="width: ${porcentajeSPOA}%;">${totalCargaSPOA} casos (${porcentajeSPOA.toFixed(1)}%)</div>
                                </div>
                                <div class="bar">
                                    <div class="bar-label">Apoyos Seccionales</div>
                                    <div class="bar-value" style="width: ${porcentajeApoyos}%;">${totalCargaApoyos} casos (${porcentajeApoyos.toFixed(1)}%)</div>
                                </div>
                                <div class="bar">
                                    <div class="bar-label">Apoyo-DECDI</div>
                                    <div class="bar-value" style="width: ${porcentajeDECDI}%;">${totalCargaDECDI} casos (${porcentajeDECDI.toFixed(1)}%)</div>
                                </div>
                            </div>
                        </div>

                        <div class="filtros-container">
                            <div class="filtro-group">
                                <div class="filtro-label">Ordenar por:</div>
                                <select id="ordenCarga" onchange="ordenarCargaFiscal()">
                                    <option value="total">Carga Total (Descendente)</option>
                                    <option value="spoa">SPOA/DECDI (Descendente)</option>
                                    <option value="apoyos">Apoyos Seccionales (Descendente)</option>
                                    <option value="decdi">Apoyo-DECDI (Descendente)</option>
                                    <option value="nombre">Nombre (Ascendente)</option>
                                </select>
                            </div>
                            
                            <div class="resultados-filtro" id="resultadosCargaFiscal" style="max-height: 600px;">
                                ${resultadosCargaHTML}
                            </div>
                        </div>

                        <!-- Sem치foro de Carga Laboral -->
                        <div class="semaforo-container">
                            <h3 class="semaforo-title">Sem치foro de Carga Laboral</h3>
                            <div class="semaforo-grid" id="semaforoCarga">
                                ${semaforoHTML}
                            </div>
                            <div class="semaforo-leyenda">
                                <div class="leyenda-item">
                                    <div class="leyenda-color leyenda-alta"></div>
                                    <span>Alta Carga (25+ casos)</span>
                                </div>
                                <div class="leyenda-item">
                                    <div class="leyenda-color leyenda-media"></div>
                                    <span>Media Carga (15-24 casos)</span>
                                </div>
                                <div class="leyenda-item">
                                    <div class="leyenda-color leyenda-baja"></div>
                                    <span>Baja Carga (0-14 casos)</span>
                                </div>
                            </div>
                        </div>

                        <div class="insight">
                            <h3>Hallazgos de Distribuci칩n de Carga</h3>
                            <p><strong>Distribuci칩n de Carga:</strong> ${fiscalesSobrePromedio} de ${totalFiscales} fiscales (${Math.round((fiscalesSobrePromedio/totalFiscales)*100)}%) tienen carga por encima del promedio (${promedioCarga.toFixed(1)} casos).</p>
                            <p><strong>Mayor Carga Individual:</strong> ${fiscalMayorCarga.nombre} con ${fiscalMayorCarga.total} casos totales (${fiscalMayorCarga.spoa} SPOA/DECDI, ${fiscalMayorCarga.apoyos} Apoyos Seccionales, ${fiscalMayorCarga.decdi} Apoyo-DECDI).</p>
                            <p><strong>Distribuci칩n por Tipo:</strong> SPOA/DECDI representa el ${porcentajeSPOA.toFixed(1)}% del trabajo total, seguido de Apoyos Seccionales (${porcentajeApoyos.toFixed(1)}%) y Apoyo-DECDI (${porcentajeDECDI.toFixed(1)}%).</p>
                            <p><strong>Focos de Atenci칩n:</strong> ${fiscalesAltaSPOA} fiscales con alta carga SPOA, ${fiscalesAltaApoyos} con alta carga en apoyos, ${fiscalesAltaDECDI} con alta carga DECDI.</p>
                            <p><strong>Recomendaci칩n:</strong> Considerar redistribuci칩n de casos en los ${cargaAlta.length} fiscales con carga alta para balancear la carga laboral y mejorar la eficiencia.</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function generarPresentacionCompleta() {
            const slidesContainer = document.getElementById('slidesContainer');
            slidesContainer.innerHTML = '';

            // Calcular estad칤sticas
            const totalFuncionarios = datosPersonas.length;
            const provisionalidadCount = datosPersonas.filter(p => p.nombramiento === 'PROVISIONALIDAD').length;
            const encargosCount = datosPersonas.filter(p => p.encargo && p.encargo !== '').length;
            const propiedadCount = totalFuncionarios - provisionalidadCount;
            const porcentajeProvisionalidad = Math.round((provisionalidadCount / totalFuncionarios) * 100);
            const porcentajeEncargos = Math.round((encargosCount / totalFuncionarios) * 100);
            const encargosProvisionalidad = datosPersonas.filter(p => p.encargo && p.encargo !== '' && p.nombramiento === 'PROVISIONALIDAD').length;
            const encargosPropiedad = encargosCount - encargosProvisionalidad;
            const porcentajeEncargosProvisionalidad = Math.round((encargosProvisionalidad / encargosCount) * 100);

            // Slide 1: Portada
            slidesContainer.innerHTML += `
                <div class="slide">
                    <div class="content">
                        <div class="slide-header">
                            <h1 class="slide-title">An치lisis de Planta de Personal</h1>
                            <p class="slide-subtitle">Direcci칩n Especializada contra los Delitos Inform치ticos (DECDI)</p>
                            <p class="slide-subtitle">Fecha de corte: ${new Date().toLocaleDateString()}</p>
                        </div>
                        <div class="stats-container">
                            <div class="stat-card">
                                <div class="stat-value">${totalFuncionarios}</div>
                                <div class="stat-label">Total de Funcionarios</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${porcentajeProvisionalidad}%</div>
                                <div class="stat-label">Provisionalidad (${provisionalidadCount} de ${totalFuncionarios} funcionarios)</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${porcentajeEncargos}%</div>
                                <div class="stat-label">Con Encargos Activos (${encargosCount} de ${totalFuncionarios} funcionarios)</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // Slide 2: Tipos de Nombramiento
            slidesContainer.innerHTML += `
                <div class="slide">
                    <div class="content">
                        <h2>Tipos de Nombramiento</h2>
                        
                        <div class="chart-container">
                            <div class="chart">
                                <h3>Distribuci칩n por Tipo de Nombramiento</h3>
                                <div class="bar">
                                    <div class="bar-label">PROVISIONALIDAD</div>
                                    <div class="bar-value" style="width: ${porcentajeProvisionalidad}%;">${provisionalidadCount} (${porcentajeProvisionalidad}%)</div>
                                </div>
                                <div class="bar">
                                    <div class="bar-label">PROPIEDAD</div>
                                    <div class="bar-value" style="width: ${100 - porcentajeProvisionalidad}%;">${propiedadCount} (${100 - porcentajeProvisionalidad}%)</div>
                                </div>
                            </div>
                        </div>

                        <div class="insight">
                            <h3>Hallazgo Cr칤tico</h3>
                            <p>Existe una <span class="highlight">alta proporci칩n de provisionalidad (${porcentajeProvisionalidad}%)</span> en la planta de personal de la DECDI. Solo ${propiedadCount} funcionarios (${100 - porcentajeProvisionalidad}%) tienen nombramiento en propiedad, lo que afecta la estabilidad laboral y la continuidad de los procesos.</p>
                        </div>
                    </div>
                </div>
            `;

            // Slide 3: Todos los Cargos Nominales
            const cargosUnicos = [...new Set(datosPersonas.map(p => p.cargo))];
            const cargosHTML = cargosUnicos.map(cargo => {
                const personasEnCargo = datosPersonas.filter(p => p.cargo === cargo);
                return `
                    <div class="cargo-completo-item">
                        <div class="cargo-completo-header">
                            <div class="cargo-completo-nombre">${cargo}</div>
                            <div class="cargo-completo-total">${personasEnCargo.length}</div>
                        </div>
                        <div class="cargo-completo-personas">
                            ${personasEnCargo.map(persona => `
                                <div class="persona-cargo-item">
                                    <div class="persona-cargo-nombre">${persona.nombre}</div>
                                    <div class="persona-cargo-estado">
                                        <span class="tipo-nombramiento ${persona.nombramiento === 'PROVISIONALIDAD' ? 'provisionalidad' : 'propiedad'}">
                                            ${persona.nombramiento}
                                        </span>
                                        ${persona.encargo ? 
                                            `<span class="tipo-nombramiento encargo">ENCARGO</span>` : 
                                            ''
                                        }
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');

            slidesContainer.innerHTML += `
                <div class="slide">
                    <div class="content">
                        <h2>Inventario de Cargos Nominales (NOM_CARGO)</h2>
                        <p>Lista completa de todos los cargos nominales existentes en la DECDI</p>
                        
                        <div class="search-section">
                            <input type="text" class="search-input" id="searchCargos" placeholder="Buscar cargo espec칤fico..." onkeyup="filtrarCargos()">
                            <div><small>Escriba para filtrar los cargos por nombre</small></div>
                        </div>
                        
                        <div class="todos-cargos-container">
                            <div class="cargos-grid" id="cargosGrid">
                                ${cargosHTML}
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // Slide 4: Encargos Activos
            slidesContainer.innerHTML += `
                <div class="slide">
                    <div class="content">
                        <h2>Encargos Activos - Situaci칩n Cr칤tica</h2>
                        
                        <div class="stats-container">
                            <div class="stat-card">
                                <div class="stat-value">${encargosCount}</div>
                                <div class="stat-label">Total de Encargos</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${encargosProvisionalidad}</div>
                                <div class="stat-label">En Provisionalidad</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${encargosPropiedad}</div>
                                <div class="stat-label">En Propiedad</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${porcentajeEncargosProvisionalidad}%</div>
                                <div class="stat-label">Encargos en Provisionalidad</div>
                            </div>
                        </div>

                        <div class="insight">
                            <h3>An치lisis de Encargos</h3>
                            <p><span class="critical">${porcentajeEncargosProvisionalidad}% de los encargos (${encargosProvisionalidad} de ${encargosCount}) son realizados por funcionarios en provisionalidad.</span> Esto representa un <span class="highlight">doble nivel de temporalidad</span> que afecta severamente la estabilidad organizacional.</p>
                            <p><strong>Fecha m치xima de encargo identificada: ${new Date(new Date().setFullYear(new Date().getFullYear() + 2)).toLocaleDateString()}</strong></p>
                        </div>
                    </div>
                </div>
            `;

            // Slide 5: Gr치fica de Cargos
            const cargosAgrupados = {};
            datosPersonas.forEach(persona => {
                if (!cargosAgrupados[persona.cargo]) {
                    cargosAgrupados[persona.cargo] = {
                        total: 0,
                        provisionalidad: 0,
                        propiedad: 0,
                        conEncargo: 0
                    };
                }
                cargosAgrupados[persona.cargo].total++;
                if (persona.nombramiento === 'PROVISIONALIDAD') {
                    cargosAgrupados[persona.cargo].provisionalidad++;
                } else {
                    cargosAgrupados[persona.cargo].propiedad++;
                }
                if (persona.encargo) {
                    cargosAgrupados[persona.cargo].conEncargo++;
                }
            });

            const graficaCargosHTML = Object.entries(cargosAgrupados).map(([cargo, datos]) => `
                <div class="cargo-grafica-item">
                    <div class="cargo-grafica-header">
                        <div class="cargo-grafica-nombre">${cargo}</div>
                        <div class="cargo-grafica-total">${datos.total}</div>
                    </div>
                    <div class="cargo-grafica-detalle">
                        <div class="cargo-grafica-linea">
                            <div class="cargo-grafica-tipo">Provisionalidad</div>
                            <div class="cargo-grafica-cantidad">${datos.provisionalidad}</div>
                        </div>
                        <div class="cargo-grafica-linea">
                            <div class="cargo-grafica-tipo">Propiedad</div>
                            <div class="cargo-grafica-cantidad">${datos.propiedad}</div>
                        </div>
                        <div class="cargo-grafica-linea">
                            <div class="cargo-grafica-tipo">Con Encargo</div>
                            <div class="cargo-grafica-cantidad">${datos.conEncargo}</div>
                        </div>
                    </div>
                </div>
            `).join('');

            slidesContainer.innerHTML += `
                <div class="slide">
                    <div class="content">
                        <h2>Distribuci칩n de Cargos</h2>
                        <p>An치lisis detallado de los cargos y su composici칩n por tipo de nombramiento</p>
                        
                        <div class="grafica-cargos" id="graficaCargos">
                            ${graficaCargosHTML}
                        </div>
                    </div>
                </div>
            `;

            // Slide 6: Filtros Interactivos
            slidesContainer.innerHTML += `
                <div class="slide">
                    <div class="content">
                        <h2>B칰squeda de Personal</h2>
                        <p>Filtre el personal por cargo nominal o cargo de encargo</p>
                        
                        <div class="filtros-container">
                            <div class="filtro-group">
                                <div class="filtro-label">Cargo Nominal:</div>
                                <select id="filtroCargo" onchange="aplicarFiltros()">
                                    <option value="">Todos los cargos</option>
                                    ${cargosUnicos.map(cargo => `<option value="${cargo}">${cargo}</option>`).join('')}
                                </select>
                            </div>
                            
                            <div class="filtro-group">
                                <div class="filtro-label">Cargo de Encargo:</div>
                                <select id="filtroEncargo" onchange="aplicarFiltros()">
                                    <option value="">Todos los encargos</option>
                                    ${[...new Set(datosPersonas.map(p => p.encargo).filter(e => e))].map(encargo => `<option value="${encargo}">${encargo}</option>`).join('')}
                                </select>
                            </div>
                            
                            <div class="resultados-filtro" id="resultadosFiltro">
                                <!-- Resultados generados din치micamente -->
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // Slide 7: An치lisis de Carga Laboral por Fiscal (USANDO LA NUEVA FUNCI칍N)
            slidesContainer.innerHTML += generarSlideCargaLaboral();

            // Slide 8: Recomendaciones
            slidesContainer.innerHTML += `
                <div class="slide">
                    <div class="content">
                        <h2>Recomendaciones Estrat칠gicas</h2>
                        
                        <div class="recommendation">
                            <h3>Acciones Urgentes</h3>
                            <ol>
                                <li><strong>Implementar plan urgente de estabilizaci칩n laboral</strong> para convertir provisionalidad a propiedad</li>
                                <li><strong>Revisar inmediatamente la pol칤tica de encargos</strong> para funcionarios en provisionalidad</li>
                                <li><strong>Priorizar la propiedad en cargos cr칤ticos y de liderazgo</strong></li>
                                <li><strong>Establecer l칤mites temporales</strong> para encargos en personal provisional</li>
                                <li><strong>Crear programa de retenci칩n</strong> para personal clave en provisionalidad</li>
                                <li><strong>Evaluar reestructuraci칩n de planta</strong> para adecuarla a necesidades permanentes</li>
                            </ol>
                        </div>

                        <div class="stats-container">
                            <div class="stat-card">
                                <div class="stat-value">九</div>
                                <div class="stat-label">Estabilidad Laboral</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">九</div>
                                <div class="stat-label">Continuidad Operativa</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">九</div>
                                <div class="stat-label">Planificaci칩n Estrat칠gica</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // Actualizar variables de control
            totalSlides = document.querySelectorAll('.slide').length;
            
            // Generar indicadores
            const indicadores = document.getElementById('indicadores');
            indicadores.innerHTML = '';
            for (let i = 0; i < totalSlides; i++) {
                const indicador = document.createElement('div');
                indicador.className = 'indicador' + (i === 0 ? ' activo' : '');
                indicador.onclick = () => irASlide(i);
                indicadores.appendChild(indicador);
            }

            // Inicializar navegaci칩n
            irASlide(0);
        }

        // Funciones de navegaci칩n
        function cambiarSlide(direccion) {
            const nuevoSlide = slideActual + direccion;
            if (nuevoSlide >= 0 && nuevoSlide < totalSlides) {
                irASlide(nuevoSlide);
            } else if (nuevoSlide >= totalSlides) {
                irASlide(0);
            }
        }

        function irASlide(nuevoSlide) {
            slideActual = nuevoSlide;
            const slidesContainer = document.getElementById('slidesContainer');
            slidesContainer.style.transform = `translateX(-${slideActual * 100}vw)`;
            
            // Actualizar indicadores
            document.querySelectorAll('.indicador').forEach((ind, index) => {
                ind.classList.toggle('activo', index === slideActual);
            });
            
            // Actualizar estado de botones
            const btnAnterior = document.getElementById('btnAnterior');
            const btnSiguiente = document.getElementById('btnSiguiente');
            btnAnterior.disabled = slideActual === 0;
            btnSiguiente.textContent = slideActual === totalSlides - 1 ? 'Reiniciar' : 'Siguiente';
        }

        // Funciones auxiliares para los filtros
        function aplicarFiltros() {
            const filtroCargo = document.getElementById('filtroCargo').value;
            const filtroEncargo = document.getElementById('filtroEncargo').value;
            const resultados = document.getElementById('resultadosFiltro');
            
            const personasFiltradas = datosPersonas.filter(persona => {
                const coincideCargo = !filtroCargo || persona.cargo === filtroCargo;
                const coincideEncargo = !filtroEncargo || persona.encargo === filtroEncargo;
                return coincideCargo && coincideEncargo;
            });
            
            resultados.innerHTML = '';
            
            if (personasFiltradas.length === 0) {
                resultados.innerHTML = '<p>No se encontraron resultados con los filtros aplicados.</p>';
                return;
            }
            
            personasFiltradas.forEach(persona => {
                const elemento = document.createElement('div');
                elemento.className = 'persona-item';
                elemento.innerHTML = `
                    <div class="persona-nombre">${persona.nombre}</div>
                    <div class="persona-cargo">Cargo: ${persona.cargo}</div>
                    <div class="persona-detalle">
                        <span class="tipo-nombramiento ${persona.nombramiento === 'PROVISIONALIDAD' ? 'provisionalidad' : 'propiedad'}">
                            ${persona.nombramiento}
                        </span>
                        ${persona.encargo ? 
                            `<span class="tipo-nombramiento encargo">Encargo: ${persona.encargo}</span>` : 
                            '<span>Sin encargo activo</span>'
                        }
                    </div>
                `;
                resultados.appendChild(elemento);
            });
        }

        function ordenarCargaFiscal() {
            const criterio = document.getElementById('ordenCarga').value;
            const resultados = document.getElementById('resultadosCargaFiscal');
            
            let cargaOrdenada;
            switch(criterio) {
                case 'spoa':
                    cargaOrdenada = [...datosCargaFiscal].sort((a, b) => b.spoa - a.spoa);
                    break;
                case 'apoyos':
                    cargaOrdenada = [...datosCargaFiscal].sort((a, b) => b.apoyos - a.apoyos);
                    break;
                case 'decdi':
                    cargaOrdenada = [...datosCargaFiscal].sort((a, b) => b.decdi - a.decdi);
                    break;
                case 'nombre':
                    cargaOrdenada = [...datosCargaFiscal].sort((a, b) => a.nombre.localeCompare(b.nombre));
                    break;
                default:
                    cargaOrdenada = [...datosCargaFiscal].sort((a, b) => b.total - a.total);
            }

            resultados.innerHTML = '';
            cargaOrdenada.forEach(fiscal => {
                const elemento = document.createElement('div');
                elemento.className = 'persona-item';
                const maxCarga = Math.max(1, ...cargaOrdenada.map(f => f.total));
                const porcentajeTotal = (fiscal.total / maxCarga) * 100;
                const anchoBarra = Math.max(porcentajeTotal, 15);
                
                elemento.innerHTML = `
                    <div class="persona-nombre">${fiscal.nombre}</div>
                    <div class="persona-cargo">${fiscal.cargo || 'Fiscal'} - ${fiscal.despachoFiscal}</div>
                    <div class="persona-detalle">
                        <div class="carga-stats">
                            <div class="carga-stat-item">
                                <div class="carga-stat-value">${fiscal.spoa}</div>
                                <div class="carga-stat-label">SPOA/DECDI</div>
                            </div>
                            <div class="carga-stat-item">
                                <div class="carga-stat-value">${fiscal.apoyos}</div>
                                <div class="carga-stat-label">Apoyos Sec.</div>
                            </div>
                            <div class="carga-stat-item">
                                <div class="carga-stat-value">${fiscal.decdi}</div>
                                <div class="carga-stat-label">Apoyo-DECDI</div>
                            </div>
                            <div class="carga-stat-item">
                                <div class="carga-stat-value">${fiscal.total}</div>
                                <div class="carga-stat-label">Total</div>
                            </div>
                        </div>
                        <div class="carga-bar-container">
                            <div class="carga-bar" style="width: ${anchoBarra}%">
                                ${fiscal.total} casos
                            </div>
                        </div>
                    </div>
                `;
                resultados.appendChild(elemento);
            });
        }

        function filtrarCargos() {
            const searchTerm = document.getElementById('searchCargos').value.toLowerCase();
            const elementosCargo = document.querySelectorAll('.cargo-completo-item');
            
            elementosCargo.forEach(elemento => {
                const cargo = elemento.querySelector('.cargo-completo-nombre').textContent.toLowerCase();
                if (cargo.includes(searchTerm)) {
                    elemento.style.display = 'block';
                } else {
                    elemento.style.display = 'none';
                }
            });
        }

        // Navegaci칩n con teclado
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') cambiarSlide(-1);
            if (e.key === 'ArrowRight') cambiarSlide(1);
        });
    </script>
</body>
</html>
